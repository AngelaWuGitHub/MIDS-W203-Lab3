---
title: "Lab 3 (Bhuvnesh Sharma, Weixin Wu)"
author: "Bhuvnesh Sharma, Weixin Wu"
date: "March 22, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





# Introduction

Crime is huge menace in the society, there have been many attempts in past to reduce crime rates within communities in North Carolina.
Traditional politicians and conventional approach has assumed that tough on crime is an effective tool to curb crime. Being tough on crime is regularly misunderstood as longer and mandatory prison sentences. This misguided strategy can lead to stateâ€™s higher investment on prison infrastructure and also make laws which can promote mandatory prison sentences appear as effective crime fighting tool.
The goal of this study is to uncover the real facts around the crime rates within North Carolina to develop effective state policy around to reduce crime rates. Key motivation of the report discover the real drivers and instruments which the policy makers can use and have meaningful impact on crime. Study intends to empower the state politicians , key legislative leaders with key facts which have been based on data and not on conventional  empirical narratives.
Study intends to discover key variables which have major impact on crime rates in North Carolina . This information would be critical for voters to understand so that they can make an informed decision on a important election issue.



# Data Cleansing

```{r}
crimeData <- read.csv("crime_v2.csv")
summary(crimeData)
```


As shown in the summary table, there are 6 NA's in every variable. 
After reviewing the data, we found that all NA's are in 6 rows, so we removed those rows as they did not provide any information.
```{r}
crimeData2 <- crimeData[complete.cases(crimeData),]
```


Variable 'prbconv' was incorrectly displayed as a text field. We converted it to numermic.
```{r}
crimeData2 <- transform(crimeData2, prbconv = as.numeric(as.character(prbconv)))
summary(crimeData2$prbconv)
```


Usually the probability variable should be bound between 0 and 1.
However, there is one observation with 'prbarr' (probability of arrest) higher than 1, 
and 10 observations with 'prbconv' (probability of conviction) higher than 1.
```{r}
nrow(crimeData2[which(crimeData2$prbarr>1),])
nrow(crimeData2[which(crimeData2$prbconv>1),])
```
Variable 'prbarr' is defined as the ratio of arrests to offenses. 
One possible explanation for 'prbarr' being greater than 1 is that 
multiple people who convicted a single crime together is counted as one conviction but multiple arrests.   
Variable 'prbconv' is defined as the ratio of convictions to arrests.
One possible explanation for 'prbconv' being greater than 1 is that 
one person who is convicted of multiple crimes but only arrested once.   
Without further information on the variables, we could not conclude whether these values are invalid.
So we left those observations in the data.


Variable 'pctmin80' (percent of minority in 1980) is expressed as percentages. 
We converted it into decimals to be consistent with variable 'pctymle' (percent of young male).
```{r}
crimeData2$pctmin80_2 <- crimeData2$pctmin80/100
```

```{r}
################################################################# / 1000
```

The max value of variable 'wser' (weekly wage of service industry) is significantly higher than its third quartile.
The histogram below shows that the max value (2177.068) is significantly higher than the rest of values.
```{r}
hist(crimeData2$wser, main="Histogram of Weekly Wage in Service Industry")
crimeData2[which(crimeData2$wser>2000),]
```
We examined County 185, whose wser is 2177.068.
We noticed that most other weekly wage variables for County 185 are below the means.
You would expect that a richer county would have weekly wage in multiple industries to be higher than the average.
So it's very unlikely for a county to have lower than average weekly wage on constructure, transportation, retail, finance, etc. 
but extremely high weekly wage on the service industry.
In addition, an average weekly wage of 2177.068 in 1987 is an unreasonable value.
So we believed 2177.068 is erroneous.
We removed this observation from the data.
```{r}
crimeData2 <- crimeData2[which(crimeData2$wser<2000),]
```



# Exploratory Data Analysis
We wanted to first investigate the relationship between our target variable (crime rate) and the variables of key interest.

## Probability of arrest (prbarr)
The scatter plot of crmrte vs. prbarr on the left shows an exponential decay trend.
In addition, the variation of crmrte decreases substantially as prbarr increases. 
This suggests that the relationship between crmrte and prbarr is not linear.
So we took the log of crime rate, and then re-graph the scatter plot (shown on the right).
The scatter plot of crmrte_log vs. prbarr indicates a more linear relationship 
and the variation of crmrte_log does not vary as much with prbarr.
The correlation coefficient further supports the transformation.  
* The correlation between crmrte and prbarr is -0.41  
* The correlation between crmrte_log and prbarr is -0.50  
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbarr, crimeData2$crmrte)
crimeData2$crmrte_log = log(crimeData2$crmrte)
plot(crimeData2$prbarr, crimeData2$crmrte_log)
cor(crimeData2$prbarr, crimeData2$crmrte)
cor(crimeData2$prbarr, crimeData2$crmrte_log)
```
In addition, we noticed a leveraged data point in the graph, that's County 115. 
County 115 has significantly higher probability of arrest than all other counties.
```{r}
plot(crimeData2$prbarr, crimeData2$crmrte)
text(crimeData2$prbarr, crimeData2$crmrte, labels = crimeData2$county, cex=0.7, pos=3)
```


## Probability of conviction
Similar to prbarr, the scatter plot of crmrte vs. prbconv on the left shows an exponential decay trend.
In addition, the variation of crmrte decreases substantially as prbconv increases. 
This suggests that the relationship between crmrte and prbconv is not linear.
So we took the log of crime rate, and then re-graph the scatter plot (shown on the right).
The scatter plot of crmrte_log vs. prbconv indicates a more linear relationship 
and the variation of crmrte_log does not vary as much with prbconv
The correlation coefficient further supports the transformation.
* The correlation between crmrte and prbarr is -0.37
* The correlation between crmrte_log and prbarr is -0.41
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbconv, crimeData2$crmrte)
plot(crimeData2$prbconv, crimeData2$crmrte_log)
cor(crimeData2$prbconv, crimeData2$crmrte)
cor(crimeData2$prbconv, crimeData2$crmrte_log)

######################### ? ################################
crimeData2$prbconv_cap = replace(crimeData2$prbconv, crimeData2$prbconv > 1, 1)
plot(crimeData2$prbconv_cap, crimeData2$crmrte)
plot(crimeData2$prbconv_cap, crimeData2$crmrte_log)
cor(crimeData2$prbconv_cap, crimeData2$crmrte)
cor(crimeData2$prbconv_cap, crimeData2$crmrte_log)
############################################################
```


## Probability of prison | Average sentence days
Neither scatter plots of prbpris vs. crmrte and avgsen vs. crmrte shows obvious relationships.
The correlation coefficient is only 0.05 and 0.01 respectively.
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbpris, crimeData2$crmrte)
plot(crimeData2$avgsen, crimeData2$crmrte)
cor(crimeData2$prbpris, crimeData2$crmrte)
cor(crimeData2$avgsen, crimeData2$crmrte)
```




xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx side by side Probability of prison | Average sentence days

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx top-coded variables


xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx check whether the weekly wages highly correlated => transformation (sum)

```{r}
plot(crimeData2$prbpris, crimeData2$crmrte)
plot(crimeData2$avgsen, crimeData2$crmrte)
cor(crimeData2$crmrte, crimeData2$prbarr)
cor(crimeData2$crmrte, crimeData2$prbconv)
cor(crimeData2$crmrte, crimeData2$prbpris)
cor(crimeData2$crmrte, crimeData2$avgsen)
crimeData2$crmrte_log = log(crimeData2$crmrte)
plot(crimeData2$prbarr, crimeData2$crmrte_log)
plot(crimeData2$prbconv, crimeData2$crmrte_log)
plot(crimeData2$prbpris, crimeData2$crmrte_log)
plot(crimeData2$avgsen, crimeData2$crmrte_log)
cor(crimeData2$crmrte_log,crimeData2$prbarr)
cor(crimeData2$crmrte_log,crimeData2$prbconv)
cor(crimeData2$crmrte_log,crimeData2$prbpris)
cor(crimeData2$crmrte_log,crimeData2$avgsen)
```





```{r}
#crimeData2_drop <- c("year") # extra column
#crimeData3 = crimeData2[ , !(names(crimeData2) %in% crimeData2_drop)]
#correlations <- cor(na.omit(crimeData3[,-1,]))

# correlations
#row_indic <- apply(correlations, 1, function(x) sum(x > 0.3 | x < -0.3) > 1)
#correlations<- correlations[row_indic ,row_indic ]
#install.packages("corrplot", dependencies = TRUE)
#library(corrplot)
#corrplot(correlations, method="square")
```













```{r}
hist(crimeData2$crmrte)
hist(crimeData2$wser)
```





```{r}
library(car)
scatterplotMatrix(~ crmrte+wcon+wtuc, data=crimeData2, diagonal="histogram")
scatterplotMatrix(~ crmrte+wtrd+wfir, data=crimeData2, diagonal="histogram")
scatterplotMatrix(~ crmrte+wser+wmfg, data=crimeData2, diagonal="histogram")
scatterplotMatrix(~ crmrte+wfed+wsta+wloc, data=crimeData2, diagonal="histogram")
scatterplotMatrix(~ crmrte+mix+pctymle, data=crimeData2, diagonal="histogram")
```
I think I would delete wser = 2177.068 because it significantly distorted the trend.
wmfg has a weird shape.
wsta has a weird flat then increase trend.
not sure how to interpret the variable 'mix'
pctymle has one extreme value as well. This data point is highly leveraged and could potentially be influential.
Most other variables look like they have linear relationships with crmrte.

```{r}
#crimeData3[which(crimeData2$pctymle>0.1),]
#crimeData3$w_sum <- crimeData3$wcon+crimeData3$wtuc+crimeData3$wtrd+crimeData3$wfir+crimeData3$wser+crimeData3$wmfg+crimeData3$wfed+crimeData3$wsta+crimeData3$wloc
#cor(crimeData3$crmrte,crimeData3$w_sum)
```









# Model Building 1
```{r}
step(lm(crmrte ~ prbarr+prbconv+prbpris+avgsen+polpc+density+taxpc+west+central+urban+pctmin80_2+wcon+wtuc+wtrd+wfir+wser+wmfg+wfed+wsta+wloc+mix+pctymle, data=crimeData2), direction="both")
```


```{r}
scatterplotMatrix(~ crmrte+prbarr+prbconv+prbpris+avgsen, data=crimeData2, diagonal="histogram")
plot(crimeData2$prbarr, crimeData2$crmrte)
text(crimeData2$prbarr, crimeData2$crmrte, labels = crimeData2$county, cex=0.7, pos=3)


plot(crimeData2$prbconv, crimeData2$crmrte)
text(crimeData2$prbconv, crimeData2$crmrte, labels = crimeData2$county, cex=0.7, pos=3)
plot(crimeData2$prbpris, crimeData2$crmrte)
plot(crimeData2$avgsen, crimeData2$crmrte)
cor(crimeData2$crmrte, crimeData2$prbarr)
cor(crimeData2$crmrte, crimeData2$prbconv)
cor(crimeData2$crmrte, crimeData2$prbpris)
cor(crimeData2$crmrte, crimeData2$avgsen)
crimeData2$crmrte_log = log(crimeData2$crmrte)
plot(crimeData2$prbarr, crimeData2$crmrte_log)
plot(crimeData2$prbconv, crimeData2$crmrte_log)
plot(crimeData2$prbpris, crimeData2$crmrte_log)
plot(crimeData2$avgsen, crimeData2$crmrte_log)
cor(crimeData2$crmrte_log,crimeData2$prbarr)
cor(crimeData2$crmrte_log,crimeData2$prbconv)
cor(crimeData2$crmrte_log,crimeData2$prbpris)
cor(crimeData2$crmrte_log,crimeData2$avgsen)
model1 <- lm(crmrte ~ prbarr+prbconv+prbpris+avgsen, data=crimeData2)
summary(model1)
plot(model1)


## Detect heteroskedasticity, var(y) seems correlated with E(y)
## Take the log of y
crimeData2$crmrte_log = log(crimeData2$crmrte)
model2 <- lm(crmrte_log ~ prbarr+prbconv+prbpris+avgsen, data=crimeData2)
summary(model2)
plot(model2)
```

# Model Building 2



# Model Building 3



# Model Display



# Omitted Variables
