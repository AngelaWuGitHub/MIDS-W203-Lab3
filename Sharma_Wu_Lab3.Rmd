---
title: "Lab 3 (Bhuvnesh Sharma, Weixin Wu)"
author: "Bhuvnesh Sharma, Weixin Wu"
date: "March 22, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```





# Introduction

Crime is huge menace in the society, there have been many attempts in past to reduce crime rates within communities in North Carolina.
Traditional politicians and conventional approach has assumed that tough on crime is an effective tool to curb crime. Being tough on crime is regularly misunderstood as longer and mandatory prison sentences. This misguided strategy can lead to stateâ€™s higher investment on prison infrastructure and also make laws which can promote mandatory prison sentences appear as effective crime fighting tool.
The goal of this study is to uncover the real facts around the crime rates within North Carolina to develop effective state policy around to reduce crime rates. Key motivation of the report discover the real drivers and instruments which the policy makers can use and have meaningful impact on crime. Study intends to empower the state politicians , key legislative leaders with key facts which have been based on data and not on conventional  empirical narratives.
Study intends to discover key variables which have major impact on crime rates in North Carolina . This information would be critical for voters to understand so that they can make an informed decision on a important election issue.





# Data Cleansing

```{r}
crimeData <- read.csv("crime_v2.csv")
summary(crimeData)
```


As shown in the summary table, there are 6 NA's in every variable. 
After reviewing the data, we found that all NA's are in 6 rows, so we removed those rows as they did not provide any information.
```{r}
crimeData2 <- crimeData[complete.cases(crimeData),]
```


Variable 'prbconv' was incorrectly displayed as a text field. We converted it to numermic.
```{r}
crimeData2 <- transform(crimeData2, prbconv = as.numeric(as.character(prbconv)))
summary(crimeData2$prbconv)
```


Usually the probability variable should be bound between 0 and 1.
However, there is one observation with 'prbarr' (probability of arrest) higher than 1, 
and 10 observations with 'prbconv' (probability of conviction) higher than 1.
```{r}
nrow(crimeData2[which(crimeData2$prbarr>1),])
nrow(crimeData2[which(crimeData2$prbconv>1),])
```
Variable 'prbarr' is defined as the ratio of arrests to offenses. 
One possible explanation for 'prbarr' being greater than 1 is that 
multiple people who convicted a single crime together is counted as one conviction but multiple arrests.   
Variable 'prbconv' is defined as the ratio of convictions to arrests.
One possible explanation for 'prbconv' being greater than 1 is that 
one person who is convicted of multiple crimes but only arrested once.   
Without further information on the variables, we could not conclude whether these values are invalid.
So we left those observations in the data.


Variable 'pctmin80' (percent of minority in 1980) is expressed as percentages. 
We converted it into decimals to be consistent with variable 'pctymle' (percent of young male).
```{r}
crimeData2$pctmin80_2 <- crimeData2$pctmin80/100
```

```{r}
################################################################# / 1000
```

The max value of variable 'wser' (weekly wage of service industry) is significantly higher than its third quartile.
The histogram below shows that the max value (2177.068) is significantly higher than the rest of values.
```{r}
hist(crimeData2$wser, main="Histogram of Weekly Wage in Service Industry")
crimeData2[which(crimeData2$wser>2000),]
```
We examined County 185, whose wser is 2177.068.
We noticed that most other weekly wage variables for County 185 are below the means.
You would expect that a richer county would have weekly wage in multiple industries to be higher than the average.
So it's very unlikely for a county to have lower than average weekly wage on constructure, transportation, retail, finance, etc. 
but extremely high weekly wage on the service industry.
In addition, an average weekly wage of 2177.068 in 1987 is an unreasonable value.
So we believed 2177.068 is erroneous.
We removed this observation from the data.
```{r}
crimeData2 <- crimeData2[which(crimeData2$wser<2000),]
```





# Exploratory Data Analysis

## Crimes committed per person (crmrte)
The distribution of crime rate is skewed to the right, so we considered taking the log of crime rate.
After the log transformation, the distribution of crmrte_log is closer to normal.
Semilogarithmic form is interpretable later in modeling: 
it tells us what's the percentage change in crime rate in response to a unit change in explantory variables.
Our target variable is crmrte_log.
```{r}
par(mfrow=c(1,2))
hist(crimeData2$crmrte, main="Histogram of Crime Rate")
crimeData2$crmrte_log = log(crimeData2$crmrte)
hist(crimeData2$crmrte_log, main="Histogram of Log of Crime Rate")
```

## Probability of arrest (prbarr)
The scatter plot of crmrte vs. prbarr on the left shows an exponential decay trend.
In addition, the variation of crmrte decreases substantially as prbarr increases. 
We took the log of crime rate, and then re-graph the scatter plot (shown on the right).
The scatter plot of crmrte_log vs. prbarr indicates a more linear relationship 
and the variation of crmrte_log does not vary as much with prbarr.
The correlation coefficient further supports the transformation.  
* The correlation between crmrte and prbarr is -0.41  
* The correlation between crmrte_log and prbarr is -0.50  
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbarr, crimeData2$crmrte)
plot(crimeData2$prbarr, crimeData2$crmrte_log)
cor(crimeData2$prbarr, crimeData2$crmrte)
cor(crimeData2$prbarr, crimeData2$crmrte_log)
```
In addition, we noticed a leveraged data point in the graph, that's County 115. 
County 115 has significantly higher probability of arrest than all other counties.
If we removed County 115 from the data, the correlation coefficient reduced from -0.50 to -0.39.
This indicates that County 115 could be an infludential observation. 
Later when building the model, we will calculate Cook's distance to confirm that County 15 is an influential observation 
and also address the impact of influential observations to parameter estimates.
```{r}
plot(crimeData2$prbarr, crimeData2$crmrte)
text(crimeData2$prbarr, crimeData2$crmrte, labels = crimeData2$county, cex=0.7, pos=3)
crimeData3 <- crimeData2[which(crimeData2$county!=115),]
cor(crimeData3$prbarr, crimeData3$crmrte_log)
```


## Probability of conviction (prbconv)
Similar to prbarr, the scatter plot of crmrte vs. prbconv on the left shows an exponential decay trend.
In addition, the variation of crmrte decreases substantially as prbconv increases. 
We took the log of crime rate, and then re-graph the scatter plot (shown on the right).
The scatter plot of crmrte_log vs. prbconv indicates a more linear relationship 
and the variation of crmrte_log does not vary as much with prbconv
The correlation coefficient further supports the transformation.  
* The correlation between crmrte and prbarr is -0.37  
* The correlation between crmrte_log and prbarr is -0.41
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbconv, crimeData2$crmrte)
plot(crimeData2$prbconv, crimeData2$crmrte_log)
cor(crimeData2$prbconv, crimeData2$crmrte)
cor(crimeData2$prbconv, crimeData2$crmrte_log)
```


## Probability of prison (prbpris) | Average sentence days (avgsen)
Neither scatter plots below (prbpris vs. crmrte_log, avgsen vs. crmrte_log) shows obvious relationships.
The correlation coefficients0 are only 0.03 and -0.08 respectively.
```{r}
par(mfrow=c(1,2))
plot(crimeData2$prbpris, crimeData2$crmrte_log)
plot(crimeData2$avgsen, crimeData2$crmrte_log)
cor(crimeData2$prbpris, crimeData2$crmrte_log)
cor(crimeData2$avgsen, crimeData2$crmrte_log)
```


## Police per capita (polpc)
Similar to probabilities of arrest and conviction, 
we observed a linear relationship between crime rate and policy per capita in the scatter plot below.
The scatter plot also shows that County 15 has significantly higher police per capital than any other counties, 
County 15 is a highly leveraged observation. 
In addition, the variation of crmrte increases as prbconv increases, which justifies taking the log of crmrte.
The correlation between crmrte_log and polpc (after removing County 115) is 0.45.
```{r}
par(mfrow=c(1,3))
plot(crimeData2$polpc, crimeData2$crmrte)
plot(crimeData2$polpc, crimeData2$crmrte)
text(crimeData2$polpc, crimeData2$crmrte, labels = crimeData2$county, cex=0.7, pos=3)
plot(crimeData3$polpc, crimeData3$crmrte_log)
cor(crimeData3$polpc, crimeData3$crmrte_log)
```
We also noticed that the distribution of polpc is highly skewed to the right, so we took the log of polpc.
The correlation coefficient (after removing County 115) increased from 0.45 to 0.54.
```{r}
hist(crimeData2$polpc, main="Histogram of Police per Capita")
crimeData2$polpc_log <- log(crimeData2$polpc)
crimeData3 <- crimeData2[which(crimeData2$county!=115),]
cor(crimeData3$polpc_log, crimeData3$crmrte_log)
```


## People per square mile (density) | If in SMSA (urban)
The histogram shows the distribution of density is highly skewed to the right, so we took the log of density.
The scatter plot shows County 173 is highly leveraged as it has much lower population density than other counties.
Removing County 173 significantly increases correlation coefficient from 0.49 to 0.68.
The correlation between density and crmrte_log (without County 173) is 0.63, 
which is lower than the correlation between density_log and crmrte_log (without County 173) of 0.68.
This further confirms that log of density has a stronger linear relationship with log of crime rate than density does.
```{r}
hist(crimeData2$density, main="Histogram of People per Square Mile")
crimeData2$density_log <- log(crimeData2$density)
par(mfrow=c(1,2))
plot(crimeData2$density_log, crimeData2$crmrte_log)
plot(crimeData2$density_log, crimeData2$crmrte_log)
text(crimeData2$density_log, crimeData2$crmrte_log, labels = crimeData2$county, cex=0.7, pos=3)
crimeData4 <- crimeData2[which(crimeData2$county!=173),]
cor(crimeData2$density_log, crimeData2$crmrte_log)
cor(crimeData4$density_log, crimeData4$crmrte_log)
cor(crimeData4$density, crimeData4$crmrte_log)
```
Urban is a binary variable. 
The box plot shows that the the mean and interquartile range of density is significantly different 
depending on whether county is in urban area or not.
Log of density is highly correlated with urban with a correlation coefficient of 0.66. 
When building the model, we should avoid putting both variables in the model for two reasons:  
1. Adding the second variable doesn't explain much additional variation of the response variable   
2. High correlation can greatly increase the standard errors of parameter estimates
```{r}
boxplot(density~urban, data=crimeData2)
cor(crimeData4$urban, crimeData4$density_log)
```


## Tax revenue per capita (taxpc)
The scatter plot indicates there may be a weak linear relationship between taxpc and crmrte_log.
The histogram of taxpc is skewed to the right, so we considered taking the log of taxpc.
However, the correlation between taxpc and crmrte_log (0.37) is slightly higher than the correlation between taxpc_log and crmrte_log (0.36).
```{r}
par(mfrow=c(1,2))
plot(crimeData3$taxpc, crimeData3$crmrte_log)
hist(crimeData2$taxpc, main="Hist. of Tax Revenue")
crimeData2$taxpc_log <- log(crimeData2$taxpc)
cor(crimeData2$taxpc, crimeData2$crmrte_log)
cor(crimeData2$taxpc_log, crimeData2$crmrte_log)
```


## If in western/central North Carolina
We created a variable, area, to categorize the area counties reside in. 
Area takes three values: West, Central, and Other.
The box plot shows that the mean and interquartile range of crmrte_log is very similar between Central and Other.
The crmrte_log for West area is lower than other areas.
```{r}
crimeData2$area <- ifelse(crimeData2$west==1, "West", ifelse(crimeData2$central==1, "Central", "Other"))
boxplot(crmrte_log~area, data=crimeData2)
```


## Percent of minority in 1980 (pctmin80)
The scatter plot shows a weak linear relationship between log of crime rate and percent of minority.
Low correlation coefficient (0.3) also confirms that.
```{r}
plot(crimeData3$pctmin80, crimeData3$crmrte_log)
cor(crimeData2$pctmin80, crimeData2$crmrte_log)
```


## Weekly wages
There are nine variables related to weekly wages in the data. 
They represent weekly wages in different industries. 
As the correlation matrix shows, most of the weekly wages variables are highly correlated except for wsta.
When building the model, we should avoid putting all the correlated variables in the model 
for the same reason pointed out in the density/urban section of the EDA.
We also noticed that log of crime rate has the strongest linear relationship with wfed with correlation coefficeint of 0.51.
```{r}
crimeData_temp1 <- crimeData2[,c("crmrte_log","wcon", "wtuc", "wtrd", "wfir", "wser", "wmfg", "wfed", "wsta", "wloc")]
corr_DenUr <- cor(crimeData_temp1, use="pairwise")
library(corrplot)
corrplot(corr_DenUr, method="square", addCoef.col="white")
plot(crimeData3$wfed, crimeData3$crmrte_log)
```


## Offense mix: face-to-face/other (mix)
The scatter plot doesn't indicate a strong relationship between mix and log of crime rate.
The weak correlation coefficient (-0.15) also confirms that.
```{r}
plot(crimeData3$mix, crimeData3$crmrte_log)
cor(crimeData2$mix, crimeData2$crmrte_log)
```


## Percent young male (pctymle)
The scatter plot shows that the majority of counties have 5%-10% of young male. 
County 133 has significantly higher male percentage than the rest of counties.
Log of crime rate doesn't seem to vary by the percent of young male based on the scatter plot, 
which is also evidented by 0.27 correlation coefficient.
```{r}
par(mfrow=c(1,2))
plot(crimeData3$pctymle, crimeData3$crmrte_log)
plot(crimeData3$pctymle, crimeData3$crmrte_log)
text(crimeData2$pctymle, crimeData2$crmrte_log, labels = crimeData2$county, cex=0.7, pos=3)
cor(crimeData2$pctymle, crimeData2$crmrte_log)
```



?????????????????????????????????????????????????????????????? top-coded variables



?????????????????????????????????????????????????????????????? What covariates help you identify a causal effect?





# Model Building 1
```{r}
model1 <- lm(crmrte_log ~ prbarr+prbconv+prbpris+avgsen, data=crimeData2)
summary(model1)
plot(model1)
AIC(model1)
```
Cook's distance for Observation 51, which is County 115, is close to 1. 
```{r}
model2 <- lm(crmrte_log ~ prbarr+prbconv+prbpris+avgsen, data=crimeData3)
summary(model2)
plot(model2)
AIC(model2)
```












# Model Building 2
We put all the variables with correlation higher than 0.25 in the model except for those highly correlated with each other.
```{r}
model3 <- lm(crmrte_log ~ prbarr+prbconv+polpc_log+density_log+west+pctmin80+wfed+pctymle, data=crimeData2)
summary(model3)
plot(model3)
AIC(model3)
```


```{r}
model4 <- lm(crmrte_log ~ prbarr+prbconv+polpc_log+density_log+pctmin80+wfed, data=crimeData2)
summary(model4)
plot(model4)
AIC(model4)
```

?????????????????????????????????????????????????????????????????????
you should not include outcome variables that will absorb some of the causal effect you are interested in
Shall we still include polpc?
?????????????????????????????????????????????????????????????????????









```{r}
#step(lm(crmrte ~ prbarr+prbconv+prbpris+avgsen+polpc+density+taxpc+west+central+urban+pctmin80_2+wcon+wtuc+wtrd+wfir+wser+wmfg+wfed+wsta+wloc+mix+pctymle, data=crimeData2), direction="both")
```



# Model Building 3
```{r}
model5 <- lm(crmrte_log ~ prbarr+prbconv+prbpris+avgsen+polpc+density+taxpc+west+central+urban+pctmin80_2+wcon+wtuc+wtrd+wfir+wser+wmfg+wfed+wsta+wloc+mix+pctymle, data=crimeData2)
summary(model5)
plot(model5)
AIC(model5)
```


# Model Display
```{r, results='asis'}
library(stargazer)
stargazer(model1, model4, model5, type = "latex", 
          report = "vc",
          title = "Linear Models Predicting Log of Crime Rate",
          keep.stat = c("rsq", "n"),
          omit.table.layout = "n",
          float=FALSE) 
```


# Omitted Variables
